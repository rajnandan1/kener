{"version":3,"file":"2-3c01972e.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/_page.server.js","../../../.svelte-kit/adapter-node/nodes/2.js"],"sourcesContent":["import { G as GetIncidents, M as Mapper } from \"../../chunks/github.js\";\nimport fs from \"fs-extra\";\nimport { b as GetMinuteStartNowTimestampUTC, B as BeginingOfDay } from \"../../chunks/tool.js\";\nimport { S as StatusObj, P as ParseUptime, b as ParsePercentage } from \"../../chunks/helpers.js\";\nimport { p as public_env } from \"../../chunks/shared-server.js\";\nconst secondsInDay = 24 * 60 * 60;\nfunction getDayData(day0, startTime, endTime) {\n  let dayData = {\n    UP: 0,\n    DEGRADED: 0,\n    DOWN: 0,\n    timestamp: startTime,\n    cssClass: StatusObj.NO_DATA,\n    message: \"No Data\"\n  };\n  for (let i = startTime; i <= endTime; i += 60) {\n    if (day0[i] === void 0) {\n      continue;\n    }\n    if (day0[i].status == \"UP\") {\n      dayData.UP++;\n    } else if (day0[i].status == \"DEGRADED\") {\n      dayData.DEGRADED++;\n    } else if (day0[i].status == \"DOWN\") {\n      dayData.DOWN++;\n    }\n  }\n  dayData.uptimePercentage = ParseUptime(dayData.UP + dayData.DEGRADED, dayData.UP + dayData.DEGRADED + dayData.DOWN);\n  let cssClass = StatusObj.UP;\n  let message = \"Status OK\";\n  if (dayData.DEGRADED > 0) {\n    cssClass = StatusObj.DEGRADED;\n    message = \"Degraded for \" + dayData.DEGRADED + \" minutes\";\n  }\n  if (dayData.DOWN > 0) {\n    cssClass = StatusObj.DOWN;\n    message = \"Down for \" + dayData.DOWN + \" minutes\";\n  }\n  if (dayData.DEGRADED + dayData.DOWN + dayData.UP > 0) {\n    dayData.message = message;\n    dayData.cssClass = cssClass;\n  }\n  return dayData;\n}\nconst FetchData = async function(monitor, localTz) {\n  let _0Day = {};\n  let _90Day = {};\n  let uptime0Day = \"0\";\n  let dailyUps = 0;\n  let dailyDown = 0;\n  let percentage90DaysBuildUp = [];\n  let dailyDegraded = 0;\n  const now = GetMinuteStartNowTimestampUTC();\n  const midnight = BeginingOfDay({ timeZone: localTz });\n  const midnight90DaysAgo = midnight - 90 * 24 * 60 * 60;\n  const midnightTomorrow = midnight + secondsInDay;\n  for (let i = midnight; i <= now; i += 60) {\n    _0Day[i] = {\n      timestamp: i,\n      status: \"NO_DATA\",\n      cssClass: StatusObj.NO_DATA,\n      index: (i - midnight) / 60\n    };\n  }\n  let day0 = JSON.parse(fs.readFileSync(monitor.path0Day, \"utf8\"));\n  for (const timestamp in day0) {\n    const element = day0[timestamp];\n    let status = element.status;\n    if (_0Day[timestamp] !== void 0) {\n      _0Day[timestamp].status = status;\n      _0Day[timestamp].cssClass = StatusObj[status];\n      dailyUps = status == \"UP\" ? dailyUps + 1 : dailyUps;\n      dailyDown = status == \"DOWN\" ? dailyDown + 1 : dailyDown;\n      dailyDegraded = status == \"DEGRADED\" ? dailyDegraded + 1 : dailyDegraded;\n    }\n  }\n  for (let i = midnight90DaysAgo; i < midnightTomorrow; i += secondsInDay) {\n    _90Day[i] = getDayData(day0, i, i + secondsInDay - 1);\n  }\n  for (const key in _90Day) {\n    const element = _90Day[key];\n    const uptimePercentage = element.uptimePercentage;\n    delete _90Day[key].UP;\n    delete _90Day[key].DEGRADED;\n    delete _90Day[key].DOWN;\n    delete _90Day[key].uptimePercentage;\n    if (element.message == \"No Data\")\n      continue;\n    percentage90DaysBuildUp.push(parseFloat(uptimePercentage));\n  }\n  uptime0Day = ParseUptime(dailyUps + dailyDegraded, dailyUps + dailyDown + dailyDegraded);\n  return {\n    _90Day,\n    uptime0Day,\n    uptime90Day: ParsePercentage(percentage90DaysBuildUp.reduce((a, b) => a + b, 0) / percentage90DaysBuildUp.length),\n    dailyUps,\n    dailyDown,\n    dailyDegraded\n  };\n};\nasync function load({ params, route, url, parent }) {\n  let monitors = JSON.parse(fs.readFileSync(public_env.PUBLIC_KENER_FOLDER + \"/monitors.json\", \"utf8\"));\n  const parentData = await parent();\n  const siteData = parentData.site;\n  const github = siteData.github;\n  for (let i = 0; i < monitors.length; i++) {\n    const gitHubActiveIssues = await GetIncidents(monitors[i].tag, github, \"open\");\n    delete monitors[i].api;\n    delete monitors[i].defaultStatus;\n    let data = await FetchData(monitors[i], parentData.localTz);\n    monitors[i].pageData = data;\n    monitors[i].activeIncidents = await Promise.all(gitHubActiveIssues.map(Mapper, { github }));\n  }\n  return {\n    monitors\n  };\n}\nexport {\n  load\n};\n","import * as server from '../entries/pages/_page.server.js';\n\nexport const index = 2;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/2.6dabdebd.js\",\"_app/immutable/chunks/scheduler.1b18627c.js\",\"_app/immutable/chunks/index.a0ccbbe4.js\",\"_app/immutable/chunks/each.e59479a4.js\",\"_app/immutable/chunks/card-content.02ecb8a3.js\",\"_app/immutable/chunks/incident.4ef4dd12.js\",\"_app/immutable/chunks/index.2f5200cf.js\",\"_app/immutable/chunks/index.3e0e01a3.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}